library(ggplot2)
setwd("~/Dropbox/experience/airbnb/R/")
# Helpers to convert dates
setClass("asDateTime")
setAs("character","asDateTime", function(from) as.POSIXct(from, format="%Y-%m-%d %H:%M:%OS"))
setClass("asDay")
setAs("character","asDay", function(from) as.POSIXlt(from, format="%Y-%m-%d"))
setClass("asMonth")
setAs("character","asMonth", function(from) as.POSIXlt(from, format="%Y-%m"))
#....................................................................................
# Load files
f.interactions <- "../interactions.csv"
f.listings     <- "../listings.csv"
f.out.joined   <- "../joined.csv"
df.interactions <- read.csv(f.interactions,
colClasses=c(
"factor", # id_guest
"factor",  # guest_origin_contry
"factor", # id_host
"factor", # id_guest
"asDay",   # checkin_date
"numeric", # nights
"numeric", # guests
"asDateTime", # first_interaction_time_utc
"asDateTime", # first_reply_time_utc
"asDateTime", # booking_request_submitted_time_utc
"asDateTime", # host_accepted_time_utc
"asDateTime", # booking_time
"numeric"     # n_interactions
))
df.listings <- read.csv(f.listings,
colClasses=c(
"factor",  # id_listing
"factor",  # id_host
"asDay",   # date_created
"factor",  # listing_type
"numeric", # person_capacity
"numeric", # bedrooms
"numeric", # bathrooms
"numeric", # beds
"numeric", # lat
"numeric", # long
"numeric"  # instant_bookable
))
df.joined <- merge(df.interactions, df.listings, all=TRUE, by=c("id_host", "id_listing"))
f.interactions <- "../data/interactions.csv"
f.listings     <- "../data/listings.csv"
f.out.joined   <- "../data/joined.csv"
df.interactions <- read.csv(f.interactions,
colClasses=c(
"factor", # id_guest
"factor",  # guest_origin_contry
"factor", # id_host
"factor", # id_guest
"asDay",   # checkin_date
"numeric", # nights
"numeric", # guests
"asDateTime", # first_interaction_time_utc
"asDateTime", # first_reply_time_utc
"asDateTime", # booking_request_submitted_time_utc
"asDateTime", # host_accepted_time_utc
"asDateTime", # booking_time
"numeric"     # n_interactions
))
df.listings <- read.csv(f.listings,
colClasses=c(
"factor",  # id_listing
"factor",  # id_host
"asDay",   # date_created
"factor",  # listing_type
"numeric", # person_capacity
"numeric", # bedrooms
"numeric", # bathrooms
"numeric", # beds
"numeric", # lat
"numeric", # long
"numeric"  # instant_bookable
))
df.joined <- merge(df.interactions, df.listings, all=TRUE, by=c("id_host", "id_listing"))
View(df.joined)
head(df.joined, 2)
head(df.joined, 2)
head(df.joined, 1)
?merge
df.joined <- merge(df.interactions, df.listings, all.x=TRUE, by=c("id_host", "id_listing"))
head(df.joined, 2)
df.joined <- merge(df.interactions, df.listings, all=FALSE, by=c("id_host", "id_listing"))
head(df.joined, 2)
write.csv(df.joined, f.out.joined)
?sapply
